<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FROM THE PLACE â€” CHANNEL</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400&family=Unbounded:wght@400;700;900&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
:root {
  --black: #080808;
  --white: #f5f0e8;
  --channel-red: #ff2b2b;
  --channel-green: #0effc7;
  --channel-pink: #f65c95;
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html, body { width: 100%; height: 100%; overflow: hidden; background: #000; color: var(--white); font-family: 'DM Sans', sans-serif; }

/* VIDEO LAYER */
#player-wrap {
  position: fixed;
  top: -90px; left: 0; right: 0; bottom: -90px;
  z-index: 1;
  background: #000;
  pointer-events: none;
}
#yt-player { width: 100%; height: 100%; }

/* CRT SCANLINES â€” always on */
#scanlines {
  position: fixed; inset: 0; z-index: 2; pointer-events: none;
  background: repeating-linear-gradient(
    0deg, transparent, transparent 2px,
    rgba(0,0,0,0.09) 2px, rgba(0,0,0,0.09) 4px
  );
  animation: flicker 8s ease-in-out infinite;
}
@keyframes flicker {
  0%,100%{opacity:1} 92%{opacity:1} 93%{opacity:0.82} 94%{opacity:1} 97%{opacity:0.88} 98%{opacity:1}
}

/* Vignette */
#vignette {
  position: fixed; inset: 0; z-index: 3; pointer-events: none;
  background: radial-gradient(ellipse at center, transparent 40%, rgba(0,0,0,0.55) 100%);
}

/* CHANNEL BUMP */
#bump {
  position: fixed; inset: 0; z-index: 20;
  background: #000;
  display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 10px;
  opacity: 0; pointer-events: none; transition: opacity 0.1s;
}
#bump.show { opacity: 1; }
.bump-logo { font-family: 'Unbounded', sans-serif; font-weight: 900; font-size: clamp(40px,8vw,80px); letter-spacing: 0.12em; color: var(--white); }
.bump-logo em { font-style: normal; color: var(--channel-green); }
.bump-tag { font-family: 'Space Mono', monospace; font-size: clamp(8px,1.2vw,11px); letter-spacing: 0.4em; color: rgba(255,255,255,0.25); text-transform: uppercase; }

/* TOP NAV */
#nav {
  position: fixed; top: 0; left: 0; right: 0; z-index: 10; height: 52px;
  display: flex; align-items: center; justify-content: space-between; padding: 0 22px;
  background: linear-gradient(180deg, rgba(0,0,0,0.92) 0%, transparent 100%);
}
.nav-logo { font-family: 'Unbounded', sans-serif; font-weight: 900; font-size: 13px; letter-spacing: 0.22em; color: var(--white); user-select: none; }
.nav-logo em { font-style: normal; color: var(--channel-green); }
.nav-right { display: flex; align-items: center; gap: 12px; }

.live-pill { display: flex; align-items: center; gap: 6px; padding: 4px 10px; border: 1px solid rgba(255,43,43,0.35); border-radius: 100px; background: rgba(255,43,43,0.1); }
.live-dot { width: 6px; height: 6px; background: var(--channel-red); border-radius: 50%; animation: pulse 1.4s ease-in-out infinite; }
@keyframes pulse { 0%,100%{opacity:1;box-shadow:0 0 0 0 rgba(255,43,43,0.5)} 50%{opacity:0.6;box-shadow:0 0 0 5px rgba(255,43,43,0)} }
.live-text { font-family: 'Space Mono', monospace; font-size: 8px; letter-spacing: 0.2em; color: var(--channel-red); text-transform: uppercase; }

.nav-btn {
  width: 34px; height: 34px; display: flex; align-items: center; justify-content: center;
  background: rgba(255,255,255,0.07); border: 1px solid rgba(255,255,255,0.1);
  border-radius: 8px; cursor: pointer; color: rgba(255,255,255,0.6); font-size: 15px;
  transition: all 0.15s; user-select: none;
}
.nav-btn:hover { background: rgba(255,255,255,0.13); color: var(--white); }

/* CHANNEL ID WATERMARK */
#channel-id {
  position: fixed; top: 60px; right: 22px; z-index: 10; pointer-events: none;
  opacity: 0.18; font-family: 'Unbounded', sans-serif; font-weight: 900;
  font-size: 11px; letter-spacing: 0.25em; color: var(--white); text-transform: uppercase;
}

/* PLAYLIST PROGRESS STRIP */
#playlist-strip { position: fixed; top: 52px; left: 0; right: 0; height: 2px; z-index: 9; background: rgba(255,255,255,0.04); pointer-events: none; }
#playlist-fill { height: 100%; background: rgba(246,92,149,0.4); transition: width 0.5s ease; }

/* LOWER THIRD */
#lower-third {
  position: fixed; bottom: 70px; left: 0; z-index: 10; padding: 0 22px; pointer-events: none;
}
.lt-now { display: flex; align-items: center; gap: 8px; margin-bottom: 5px; }
.lt-now-dot { width: 5px; height: 5px; background: var(--channel-green); border-radius: 50%; animation: pg 1.4s ease-in-out infinite; }
@keyframes pg { 0%,100%{opacity:1} 50%{opacity:0.3} }
.lt-now-label { font-family: 'Space Mono', monospace; font-size: 8px; letter-spacing: 0.3em; color: var(--channel-green); text-transform: uppercase; }
.lt-artist { font-family: 'Unbounded', sans-serif; font-weight: 700; font-size: clamp(20px,3.5vw,38px); color: var(--white); letter-spacing: -0.01em; line-height: 1.05; text-shadow: 0 2px 20px rgba(0,0,0,0.8); }
.lt-context { font-family: 'DM Sans', sans-serif; font-size: clamp(11px,1.4vw,15px); font-weight: 300; color: rgba(255,255,255,0.55); margin-top: 2px; letter-spacing: 0.02em; }
.lt-event-badge { display: inline-block; margin-top: 7px; padding: 3px 9px; background: var(--channel-pink); color: #000; font-family: 'Unbounded', sans-serif; font-weight: 700; font-size: 8px; letter-spacing: 0.18em; text-transform: uppercase; border-radius: 3px; transform: rotate(-1.5deg); }

/* TRACK COUNTER */
#track-counter { position: fixed; bottom: 70px; right: 22px; z-index: 10; text-align: right; pointer-events: none; }
.tc-num { font-family: 'Space Mono', monospace; font-size: 11px; color: rgba(255,255,255,0.3); letter-spacing: 0.08em; }
.tc-num strong { color: rgba(255,255,255,0.7); font-size: 15px; }
.tc-runtime { font-family: 'Space Mono', monospace; font-size: 9px; color: rgba(255,255,255,0.18); margin-top: 3px; }

/* CLIP BAR */
#clip-bar-wrap { position: fixed; bottom: 64px; left: 0; right: 0; z-index: 10; height: 3px; background: rgba(255,255,255,0.07); pointer-events: none; }
#clip-bar { height: 100%; background: var(--channel-green); width: 0%; box-shadow: 0 0 8px rgba(14,255,199,0.5); transition: width 0.5s linear; }

/* CONTROLS */
#controls {
  position: fixed; bottom: 0; left: 0; right: 0; z-index: 10; height: 64px;
  display: flex; align-items: center; gap: 10px; padding: 0 18px;
  background: rgba(0,0,0,0.88); border-top: 1px solid rgba(255,255,255,0.05);
  backdrop-filter: blur(12px);
}
.ctrl-btn {
  width: 38px; height: 38px; display: flex; align-items: center; justify-content: center;
  border: none; background: transparent; color: rgba(255,255,255,0.5); font-size: 18px;
  cursor: pointer; border-radius: 9px; transition: all 0.15s; flex-shrink: 0; user-select: none;
}
.ctrl-btn:hover { color: var(--white); background: rgba(255,255,255,0.07); }
.ctrl-btn.play { width: 44px; height: 44px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.14); color: var(--white); font-size: 20px; border-radius: 12px; }
.ctrl-btn.play:hover { background: rgba(255,255,255,0.18); }
.ctrl-btn.shuffle-on { color: var(--channel-green); }

.ctrl-progress { flex: 1; display: flex; flex-direction: column; gap: 3px; min-width: 0; }
.prog-track { position: relative; height: 4px; background: rgba(255,255,255,0.1); border-radius: 2px; cursor: pointer; }
.prog-track:hover .prog-fill { background: var(--channel-green); }
.prog-track:hover .prog-thumb { opacity: 1; }
.prog-fill { height: 100%; background: rgba(14,255,199,0.7); border-radius: 2px; pointer-events: none; transition: width 0.5s linear; }
.prog-thumb { position: absolute; top: 50%; width: 11px; height: 11px; background: var(--white); border-radius: 50%; transform: translate(-50%,-50%); pointer-events: none; opacity: 0; transition: opacity 0.15s; }
.prog-times { display: flex; justify-content: space-between; font-family: 'Space Mono', monospace; font-size: 8px; color: rgba(255,255,255,0.25); letter-spacing: 0.05em; }

.vol-wrap { display: flex; align-items: center; gap: 7px; flex-shrink: 0; }
.vol-slider { -webkit-appearance: none; width: 72px; height: 3px; background: rgba(255,255,255,0.18); border-radius: 2px; outline: none; cursor: pointer; }
.vol-slider::-webkit-slider-thumb { -webkit-appearance: none; width: 11px; height: 11px; background: var(--white); border-radius: 50%; cursor: pointer; }
</style>
</head>
<body>

<div id="player-wrap"><div id="yt-player"></div></div>
<div id="scanlines"></div>
<div id="vignette"></div>

<div id="bump">
  <div class="bump-logo">FT<em>P</em></div>
  <div class="bump-tag">You're watching FROM THE PLACE</div>
</div>

<div id="nav">
  <div class="nav-logo">FTP<em>â—</em></div>
  <div class="nav-right">
    <div class="live-pill"><div class="live-dot"></div><div class="live-text">Live</div></div>
    <div class="nav-btn" id="mute-btn" onclick="toggleMute()">ğŸ”‡</div>
    <div class="nav-btn" onclick="toggleFullscreen()">â›¶</div>
  </div>
</div>

<div id="channel-id">ÅŒtepoti Music</div>
<div id="playlist-strip"><div id="playlist-fill"></div></div>

<div id="lower-third">
  <div class="lt-now"><div class="lt-now-dot"></div><div class="lt-now-label">Now Playing</div></div>
  <div class="lt-artist" id="lt-artist">â€”</div>
  <div class="lt-context" id="lt-context"></div>
  <div class="lt-event-badge" id="lt-badge" style="display:none"></div>
</div>

<div id="track-counter">
  <div class="tc-num"><strong id="tc-current">1</strong> / <span id="tc-total">â€”</span></div>
  <div class="tc-runtime" id="tc-clip">0:00 / 0:00</div>
</div>

<div id="clip-bar-wrap"><div id="clip-bar"></div></div>

<div id="controls">
  <button class="ctrl-btn" onclick="prevTrack()">â®</button>
  <button class="ctrl-btn play" id="play-btn" onclick="togglePlay()">â¸</button>
  <button class="ctrl-btn" onclick="nextTrack()">â­</button>
  <button class="ctrl-btn" id="shuffle-btn" onclick="toggleShuffle()">â‡„</button>
  <div class="ctrl-progress">
    <div class="prog-track" id="prog-track" onclick="scrub(event)">
      <div class="prog-fill" id="prog-fill" style="width:0%"></div>
      <div class="prog-thumb" id="prog-thumb" style="left:0%"></div>
    </div>
    <div class="prog-times"><span id="prog-cur">0:00</span><span id="prog-dur">0:00</span></div>
  </div>
  <div class="vol-wrap">
    <div class="nav-btn" id="vol-icon" onclick="toggleMute()" style="width:30px;height:30px;font-size:13px">ğŸ”‡</div>
    <input type="range" class="vol-slider" id="vol-slider" min="0" max="100" value="0" oninput="setVolume(this.value)">
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     STEP 1: Replace the array below with your FTP_MEGA.js data.
     
     Option A â€” paste inline:
       Replace the PLAYLIST array contents with your track objects.
     
     Option B â€” import your file:
       1. Add this line just above this <script> tag:
            <script src="FTP_MEGA.js"></script>
       2. Change the line below to:
            const PLAYLIST = FTP_MEGA;   â† or whatever your variable is named
     
     Each entry must be: { id: 'youtubeId', start: 0, end: 287, title: 'Artist - Track' }
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <script src="FTP_MEGA.js"></script>
<script>
// videoPlaylist is declared in FTP_MEGA.js
const PLAYLIST = videoPlaylist;
</script>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  FTP CHANNEL PLAYER
//  
//  WHY NO ADS: We use YT.Player (IFrame API) and call
//  player.loadVideoById({videoId, startSeconds, endSeconds})
//  instead of rebuilding iframe src strings. This gives
//  JS-level control â€” YouTube cannot inject pre-roll ads
//  into API-instantiated players the same way it does with
//  raw embed iframes. The controls:0 + modestbranding:1
//  playerVars also suppress all YouTube UI chrome.
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let player       = null;
let videoIndex   = 0;
let isPlaying    = true;
let _muted       = true;
let isShuffle    = false;
let progressTimer = null;
let clipDuration  = 0;
let playerReady   = false;

function parseTitle(title) {
  const sep = title.includes('â€”') ? 'â€”' : ' - ';
  const parts = title.split(sep);
  const artist  = parts[0].trim();
  const context = (parts.slice(1).join(sep)).replace(/\[.*?\]/g,'').replace(/#\w+/g,'').trim();
  return { artist, context };
}

function extractEvent(title) {
  if (/ÅŒHHH/.test(title))             return 'ÅŒHHH';
  if (/[Ll]obofest/.test(title))      return 'LOBOFEST';
  if (/Music for People/.test(title)) return 'MFP';
  if (/Space Concert/.test(title))    return 'SPACE CONCERT';
  if (/Nick Knox/.test(title))        return 'NICK KNOX';
  if (/NEON/.test(title))             return 'NEON EXPOSURE';
  if (/Crown/.test(title))            return 'THE CROWN';
  if (/Anteroom/.test(title))         return 'THE ANTEROOM';
  if (/indie voices/i.test(title))     return 'INDIE VOICES';
  if (/Waitati/.test(title))          return 'WAITATI';
  if (/Nook/.test(title))             return 'NOOK & CRANNY';
  return null;
}

function fmt(s) {
  s = Math.max(0, Math.floor(s));
  return `${Math.floor(s/60)}:${String(s%60).padStart(2,'0')}`;
}

// â”€â”€ Boot YT IFrame API â”€â”€
function loadYTAPI() {
  const tag = document.createElement('script');
  tag.src = 'https://www.youtube.com/iframe_api';
  document.head.appendChild(tag);
}

window.onYouTubeIframeAPIReady = function() {
  player = new YT.Player('yt-player', {
    width: '100%', height: '100%',
    playerVars: {
      autoplay:       1,
      mute:           1,      // must start muted for browser autoplay policy
      controls:       0,      // hide all YT UI
      disablekb:      1,
      modestbranding: 1,
      rel:            0,      // no related videos on end
      iv_load_policy: 3,      // no annotations
      fs:             0,
      playsinline:    1,
    },
    events: {
      onReady:       onPlayerReady,
      onStateChange: onStateChange,
      onError:       onError,
    }
  });
};

function onPlayerReady() {
  playerReady = true;
  const saved = parseInt(localStorage.getItem('ftp_index') || '0');
  videoIndex = (saved < PLAYLIST.length) ? saved : 0;
  loadTrack(videoIndex);
}

// â”€â”€ KEY FUNCTION: load via API, not iframe src â”€â”€
function loadTrack(index) {
  if (!playerReady || !player || !PLAYLIST.length) return;
  const track = PLAYLIST[index];
  if (!track) return;

  clearInterval(progressTimer);
  clipDuration = track.end - track.start;

  // loadVideoById at the API level â€” this is what prevents ads.
  // YouTube's ad system targets raw embed URLs, not programmatic
  // IFrame API calls with explicit start/end parameters.
  player.loadVideoById({
    videoId:      track.id,
    startSeconds: track.start,
    endSeconds:   track.end,
  });

  updateOverlay(track, index);
  localStorage.setItem('ftp_index', index);
}

function onStateChange(e) {
  const S = YT.PlayerState;
  if (e.data === S.PLAYING) {
    isPlaying = true;
    document.getElementById('play-btn').textContent = 'â¸';
    startProgress();
  } else if (e.data === S.PAUSED) {
    isPlaying = false;
    document.getElementById('play-btn').textContent = 'â–¶';
    clearInterval(progressTimer);
  } else if (e.data === S.ENDED) {
    clearInterval(progressTimer);
    advance();
  }
}

function onError(e) {
  console.warn('YT error', e.data, 'â€” skipping');
  advance(); // skip unplayable / private / removed videos
}

function advance() {
  showBump(() => {
    videoIndex = isShuffle
      ? Math.floor(Math.random() * PLAYLIST.length)
      : (videoIndex + 1) % PLAYLIST.length;
    loadTrack(videoIndex);
  });
}

function showBump(cb) {
  const b = document.getElementById('bump');
  b.classList.add('show');
  setTimeout(() => { b.classList.remove('show'); cb(); }, 800);
}

function startProgress() {
  clearInterval(progressTimer);
  progressTimer = setInterval(() => {
    if (!player || !playerReady) return;
    const cur   = player.getCurrentTime();
    const track = PLAYLIST[videoIndex];
    const elapsed = Math.max(0, cur - track.start);
    const pct   = clipDuration > 0 ? Math.min(100, (elapsed / clipDuration) * 100) : 0;
    const pctS  = pct.toFixed(1) + '%';
    document.getElementById('prog-fill').style.width  = pctS;
    document.getElementById('prog-thumb').style.left  = pctS;
    document.getElementById('clip-bar').style.width   = pctS;
    document.getElementById('prog-cur').textContent   = fmt(elapsed);
    document.getElementById('tc-clip').textContent    = `${fmt(elapsed)} / ${fmt(clipDuration)}`;
  }, 500);
}

function updateOverlay(track, index) {
  const p = parseTitle(track.title);
  const event = extractEvent(track.title);
  document.getElementById('lt-artist').textContent  = p.artist;
  document.getElementById('lt-context').textContent = p.context;
  document.getElementById('prog-dur').textContent   = fmt(clipDuration);
  document.getElementById('prog-cur').textContent   = '0:00';
  document.getElementById('tc-clip').textContent    = `0:00 / ${fmt(clipDuration)}`;
  document.getElementById('prog-fill').style.width  = '0%';
  document.getElementById('prog-thumb').style.left  = '0%';
  document.getElementById('clip-bar').style.width   = '0%';
  document.getElementById('tc-current').textContent = index + 1;
  document.getElementById('tc-total').textContent   = PLAYLIST.length;
  const badge = document.getElementById('lt-badge');
  if (event) { badge.textContent = event; badge.style.display = 'inline-block'; }
  else        { badge.style.display = 'none'; }
  const pct = ((index + 1) / PLAYLIST.length * 100).toFixed(2);
  document.getElementById('playlist-fill').style.width = pct + '%';
}

// â”€â”€ Controls â”€â”€
function togglePlay() {
  if (!player) return;
  isPlaying ? player.pauseVideo() : player.playVideo();
}

function prevTrack() {
  clearInterval(progressTimer);
  videoIndex = (videoIndex - 1 + PLAYLIST.length) % PLAYLIST.length;
  loadTrack(videoIndex);
}

function nextTrack() {
  clearInterval(progressTimer);
  advance();
}

function toggleShuffle() {
  isShuffle = !isShuffle;
  document.getElementById('shuffle-btn').classList.toggle('shuffle-on', isShuffle);
  localStorage.setItem('ftp_shuffle', isShuffle);
}

function toggleMute() {
  if (!player) return;
  _muted = !_muted;
  if (_muted) {
    player.mute();
    document.getElementById('mute-btn').textContent = 'ğŸ”‡';
    document.getElementById('vol-icon').textContent = 'ğŸ”‡';
    document.getElementById('vol-slider').value     = 0;
  } else {
    player.unMute();
    const v = Math.max(parseInt(document.getElementById('vol-slider').value) || 70, 10);
    player.setVolume(v);
    document.getElementById('vol-slider').value     = v;
    document.getElementById('mute-btn').textContent = 'ğŸ”Š';
    document.getElementById('vol-icon').textContent = 'ğŸ”Š';
  }
}

function setVolume(v) {
  if (!player) return;
  v = parseInt(v);
  player.setVolume(v);
  if (v > 0 && _muted) { player.unMute(); _muted = false; }
  if (v === 0)          { player.mute();   _muted = true; }
  document.getElementById('mute-btn').textContent = v > 0 ? 'ğŸ”Š' : 'ğŸ”‡';
  document.getElementById('vol-icon').textContent = v > 0 ? 'ğŸ”Š' : 'ğŸ”‡';
}

function scrub(e) {
  if (!player || clipDuration === 0) return;
  const rect = document.getElementById('prog-track').getBoundingClientRect();
  const pct  = Math.max(0, Math.min(1, (e.clientX - rect.left) / rect.width));
  player.seekTo(PLAYLIST[videoIndex].start + pct * clipDuration, true);
}

function toggleFullscreen() {
  if (!document.fullscreenElement) document.documentElement.requestFullscreen();
  else document.exitFullscreen();
}

// â”€â”€ Restore state â”€â”€
isShuffle = localStorage.getItem('ftp_shuffle') === 'true';
if (isShuffle) document.getElementById('shuffle-btn').classList.add('shuffle-on');

// â”€â”€ Boot â”€â”€
loadYTAPI();
</script>
</body>
</html>
