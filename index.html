<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FROM THE PLACE ‚Äî CHANNEL</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400&family=Unbounded:wght@400;700;900&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
:root {
  --black: #080808;
  --white: #f5f0e8;
  --channel-red: #ff2b2b;
  --channel-green: #0effc7;
  --channel-pink: #f65c95;
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html, body { width: 100%; height: 100%; overflow: hidden; background: #000; color: var(--white); font-family: 'DM Sans', sans-serif; }

/* VIDEO LAYER */
#player-wrap {
  position: fixed;
  top: -90px; left: 0; right: 0; bottom: -90px;
  z-index: 1;
  background: #000;
  pointer-events: none;
}
#yt-player { width: 100%; height: 100%; }

/* CRT SCANLINES */
#scanlines {
  position: fixed; inset: 0; z-index: 2; pointer-events: none;
  background: repeating-linear-gradient(
    0deg, transparent, transparent 2px,
    rgba(0,0,0,0.09) 2px, rgba(0,0,0,0.09) 4px
  );
  animation: flicker 8s ease-in-out infinite;
}
@keyframes flicker {
  0%,100%{opacity:1} 92%{opacity:1} 93%{opacity:0.82} 94%{opacity:1} 97%{opacity:0.88} 98%{opacity:1}
}

/* Vignette */
#vignette {
  position: fixed; inset: 0; z-index: 3; pointer-events: none;
  background: radial-gradient(ellipse at center, transparent 40%, rgba(0,0,0,0.55) 100%);
}

/* STATIC OVERLAY ‚Äî flashes on track change */
#static {
  position: fixed; inset: 0; z-index: 19; pointer-events: none; opacity: 0;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.4'/%3E%3C/svg%3E");
  background-size: 200px;
  mix-blend-mode: screen;
  transition: opacity 0.05s;
}
#static.flash { opacity: 0.18; }

/* TUNE-IN GATE */
#tune-in {
  position: fixed; inset: 0; z-index: 50;
  background: #0a0a0a;
  display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 0;
  cursor: pointer;
  transition: opacity 0.6s ease;
}
#tune-in.hide { opacity: 0; pointer-events: none; }
#tune-in .logotitle {
  
  margin-bottom: 2.4rem;
  animation: ti-breathe 3.5s ease-in-out infinite;
}
@keyframes ti-breathe { 0%,100%{opacity:0.8} 50%{opacity:1} }
.ti-sub {
  font-family: 'Space Mono', monospace; font-size: clamp(7px,1vw,9px);
  letter-spacing: 0.45em; color: rgba(255,255,255,0.18); text-transform: uppercase;
  margin-bottom: 2.8rem;
}
.ti-cta {
  font-family: 'Space Mono', monospace; font-size: clamp(8px,1vw,10px);
  letter-spacing: 0.35em; color: rgba(255,255,255,0.38); text-transform: uppercase;
  border: 1px solid rgba(255,255,255,0.12); padding: 10px 24px; border-radius: 3px;
  animation: ti-blink 2.2s step-end infinite;
}
@keyframes ti-blink { 0%,100%{opacity:1} 50%{opacity:0.25} }

/* CHANNEL BUMP */
#bump {
  position: fixed; inset: 0; z-index: 20;
  background: #000;
  display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 0;
  opacity: 0; pointer-events: none;
  /* snap to black instantly on show, slow fade out */
  transition: opacity 0.4s ease;
}
#bump.show { opacity: 1; transition: opacity 0.05s ease; }

.logotitle {
  border: 2px solid rgba(255,255,255,0.5);
  width: fit-content;
  margin: 0 auto 2rem;
 border-radius: 54px;
padding: 3.4rem 3.4rem 4rem;
  line-height: 0.9;
  font-family: 'DM Sans', sans-serif;
  font-weight: 400;
  font-size: clamp(28px, 6vw, 64px);
  color: var(--white);
  text-align: center;
  letter-spacing: -0.02em;
  background: rgba(16,16,16,0.9);
  transform: scale(0.6);
}
.logotitle strong {
  display: block;
  font-weight: 500;
  font-size: 1.5em;
  letter-spacing: -0.03em;
}
.bump-tag { font-family: 'Space Mono', monospace; font-size: clamp(7px,1vw,9px); letter-spacing: 0.4em; color: rgba(255,255,255,0.22); text-transform: uppercase; }

/* TOP NAV */
#nav {
  position: fixed; top: 0; left: 0; right: 0; z-index: 10; height: 52px;
  display: flex; align-items: center; justify-content: space-between; padding: 0 22px;
  background: linear-gradient(180deg, rgba(0,0,0,0.92) 0%, transparent 100%);
}
.nav-logo { font-family: 'Unbounded', sans-serif; font-weight: 900; font-size: 13px; letter-spacing: 0.22em; color: var(--white); user-select: none; }
.nav-logo em { font-style: normal; color: var(--channel-green); }
.nav-right { display: flex; align-items: center; gap: 14px; }

.live-pill { display: flex; align-items: center; gap: 6px; padding: 4px 10px; border: 1px solid rgba(255,43,43,0.35); border-radius: 100px; background: rgba(255,43,43,0.1); }
.live-dot { width: 6px; height: 6px; background: var(--channel-red); border-radius: 50%; animation: pulse 1.4s ease-in-out infinite; }
@keyframes pulse { 0%,100%{opacity:1;box-shadow:0 0 0 0 rgba(255,43,43,0.5)} 50%{opacity:0.6;box-shadow:0 0 0 5px rgba(255,43,43,0)} }
.live-text { font-family: 'Space Mono', monospace; font-size: 8px; letter-spacing: 0.2em; color: var(--channel-red); text-transform: uppercase; }

.nav-btn {
  width: 34px; height: 34px; display: flex; align-items: center; justify-content: center;
  background: rgba(255,255,255,0.07); border: 1px solid rgba(255,255,255,0.1);
  border-radius: 8px; cursor: pointer; color: rgba(255,255,255,0.6); font-size: 15px;
  transition: all 0.15s; user-select: none;
}
.nav-btn:hover { background: rgba(255,255,255,0.13); color: var(--white); }

/* CHANNEL ID WATERMARK */
#channel-id {
  position: fixed; top: 60px; right: 22px; z-index: 10; pointer-events: none;
  opacity: 0.18; font-family: 'Unbounded', sans-serif; font-weight: 900;
  font-size: 11px; letter-spacing: 0.25em; color: var(--white); text-transform: uppercase;
}

/* BROADCAST POSITION STRIP ‚Äî how far through today's rotation */
#broadcast-strip { position: fixed; top: 52px; left: 0; right: 0; height: 2px; z-index: 9; background: rgba(255,255,255,0.04); pointer-events: none; }
#broadcast-fill { height: 100%; background: rgba(246,92,149,0.4); transition: width 1s linear; }

/* LOWER THIRD ‚Äî smallest print */
#lower-third {
  position: fixed; bottom: 70px; left: 0; z-index: 10; padding: 0 22px; pointer-events: none;
}
.lt-now { display: flex; align-items: center; gap: 6px; margin-bottom: 3px; }
.lt-now-dot { width: 4px; height: 4px; background: var(--channel-green); border-radius: 50%; animation: pg 1.4s ease-in-out infinite; }
@keyframes pg { 0%,100%{opacity:1} 50%{opacity:0.3} }
.lt-now-label { font-family: 'Space Mono', monospace; font-size: 7px; letter-spacing: 0.3em; color: var(--channel-green); text-transform: uppercase; }
.lt-artist { font-family: 'Unbounded', sans-serif; font-weight: 700; font-size: clamp(11px,1.4vw,15px); color: var(--white); letter-spacing: -0.01em; line-height: 1.15; text-shadow: 0 2px 12px rgba(0,0,0,0.8); }
.lt-context { font-family: 'DM Sans', sans-serif; font-size: clamp(9px,1vw,11px); font-weight: 300; color: rgba(255,255,255,0.5); margin-top: 1px; letter-spacing: 0.02em; }
.lt-event-badge { display: none !important; margin-top: 4px; padding: 2px 6px; background: var(--channel-pink); color: #000; font-family: 'Unbounded', sans-serif; font-weight: 700; font-size: 7px; letter-spacing: 0.18em; text-transform: uppercase; border-radius: 3px; transform: rotate(-1.5deg); }

/* CLIP BAR ‚Äî read-only */
#clip-bar-wrap { position: fixed; bottom: 64px; left: 0; right: 0; z-index: 10; height: 3px; background: rgba(255,255,255,0.07); pointer-events: none; }
#clip-bar { height: 100%; background: var(--channel-green); width: 0%; box-shadow: 0 0 8px rgba(14,255,199,0.5); transition: width 0.5s linear; }

/* CONTROLS ‚Äî no skip/shuffle, read-only progress */
#controls {
  position: fixed; bottom: 0; left: 0; right: 0; z-index: 10; height: 64px;
  display: flex; align-items: center; gap: 10px; padding: 0 18px;
  background: rgba(0,0,0,0.88); border-top: 1px solid rgba(255,255,255,0.05);
  backdrop-filter: blur(12px);
}

.ctrl-progress { flex: 1; display: flex; flex-direction: column; gap: 3px; min-width: 0; }
.prog-track { position: relative; height: 4px; background: rgba(255,255,255,0.1); border-radius: 2px; cursor: default; pointer-events: none; display: none;}
.prog-fill { height: 100%; background: rgba(14,255,199,0.7); border-radius: 2px; transition: width 0.5s linear; }
.prog-times { display: flex; justify-content: space-between; font-family: 'Space Mono', monospace; font-size: 8px; color: rgba(255,255,255,0.25); letter-spacing: 0.05em; }

.vol-wrap { display: flex; align-items: center; gap: 7px; flex-shrink: 0; }
.vol-slider { -webkit-appearance: none; width: 72px; height: 3px; background: rgba(255,255,255,0.18); border-radius: 2px; outline: none; cursor: pointer; }
.vol-slider::-webkit-slider-thumb { -webkit-appearance: none; width: 11px; height: 11px; background: var(--white); border-radius: 50%; cursor: pointer; }
</style>
</head>
<body>

<div id="player-wrap"><div id="yt-player"></div></div>
<div id="scanlines"></div>
<div id="vignette"></div>
<div id="static"></div>

<!-- TUNE-IN GATE -->
<div id="tune-in" onclick="tuneIn()">
  <div class="logotitle">from the<br><strong>place</strong></div>
  <div class="ti-sub">≈åtepoti Music Television</div>
  <div class="ti-cta">Click to tune in</div>
</div>

<div id="bump">
  <div class="logotitle">from the<br><strong>place</strong></div>
  <div class="bump-tag">You're watching FROM THE PLACE</div>
</div>

<div id="nav">
  <div class="nav-logo">FTP<em>‚óè</em></div>
  <div class="nav-right">
    <div class="live-pill"><div class="live-dot"></div><div class="live-text">Broadcasting</div></div>
    <div class="nav-btn" id="mute-btn" onclick="toggleMute()">üîá</div>
    <div class="nav-btn" onclick="toggleFullscreen()">‚õ∂</div>
  </div>
</div>

<div id="channel-id">≈åtepoti Music</div>
<div id="broadcast-strip"><div id="broadcast-fill"></div></div>

<div id="lower-third">
  <div class="lt-now"><div class="lt-now-dot"></div><div class="lt-now-label">Now Playing</div></div>
  <div class="lt-artist" id="lt-artist">‚Äî</div>
  <div class="lt-context" id="lt-context"></div>
  <div class="lt-event-badge" id="lt-badge" style="display:none"></div>
</div>
<div id="clip-bar-wrap"><div id="clip-bar"></div></div>

<div id="controls">
  <div class="ctrl-progress">
    <div class="prog-track">
      <div class="prog-fill" id="prog-fill" style="width:0%"></div>
    </div>
    <div class="prog-times"><span id="prog-cur">‚Äî</span><span id="prog-dur">‚Äî</span></div>
  </div>
  <div class="vol-wrap">
    <div class="nav-btn" id="vol-icon" onclick="toggleMute()" style="width:30px;height:30px;font-size:13px">üîá</div>
    <input type="range" class="vol-slider" id="vol-slider" min="0" max="100" value="0" oninput="setVolume(this.value)">
  </div>
</div>

<script src="FTP_MEGA.js"></script>
<script>
// videoPlaylist is declared in FTP_MEGA.js
const PLAYLIST = videoPlaylist;
</script>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  FTP CHANNEL ‚Äî LIVE BROADCAST MODE
//
//  Every visitor lands mid-stream. Position is derived
//  from wall-clock time + a daily seed so the "schedule"
//  shifts each UTC day. Nobody starts at track 1.
//  No skip, no scrub, no shuffle ‚Äî you're watching TV.
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// ‚îÄ‚îÄ Total playlist duration (auto-calculated from data) ‚îÄ‚îÄ
const TOTAL_SECONDS = PLAYLIST.reduce((s, t) => s + Math.max(0, t.end - t.start), 0);

// ‚îÄ‚îÄ Live position: where in the rotation are we right now? ‚îÄ‚îÄ
function getLivePosition() {
  const nowSec = Math.floor(Date.now() / 1000);

  // Daily seed ‚Äî shifts the "schedule" each UTC day
  const dayNumber = Math.floor(nowSec / 86400);
  const dailySeed = (dayNumber * 3571) % TOTAL_SECONDS;

  const posInCycle = (nowSec % TOTAL_SECONDS + dailySeed) % TOTAL_SECONDS;

  let elapsed = 0;
  for (let i = 0; i < PLAYLIST.length; i++) {
    const clipLen = PLAYLIST[i].end - PLAYLIST[i].start;
    if (posInCycle < elapsed + clipLen) {
      return { index: i, seekOffset: posInCycle - elapsed, posInCycle };
    }
    elapsed += clipLen;
  }
  return { index: 0, seekOffset: 0, posInCycle: 0 };
}

let player         = null;
let videoIndex     = 0;
let _muted         = true;
let isPlaying      = false;
let progressTimer  = null;
let clipDuration   = 0;
let playerReady    = false;
let liveSeekOffset = 0;
let hasTunedIn     = false;

// ‚îÄ‚îÄ Formatters ‚îÄ‚îÄ
function fmt(s) {
  s = Math.max(0, Math.floor(s));
  return `${Math.floor(s/60)}:${String(s%60).padStart(2,'0')}`;
}

function parseTitle(title) {
  const sep   = title.includes('‚Äî') ? '‚Äî' : ' - ';
  const parts = title.split(sep);
  return {
    artist:  parts[0].trim(),
    context: parts.slice(1).join(sep).replace(/\[.*?\]/g,'').replace(/#\w+/g,'').trim()
  };
}

function extractEvent(title) {
  if (/≈åHHH/.test(title))              return '≈åHHH';
  if (/[Ll]obofest/.test(title))       return 'LOBOFEST';
  if (/Music for People/i.test(title)) return 'MFP';
  if (/Space Concert/i.test(title))    return 'SPACE CONCERT';
  if (/Nick Knox/i.test(title))        return 'NICK KNOX';
  if (/NEON/i.test(title))             return 'NEON EXPOSURE';
  if (/Crown/i.test(title))            return 'THE CROWN';
  if (/Anteroom/i.test(title))         return 'THE ANTEROOM';
  if (/indie voices/i.test(title))     return 'INDIE VOICES';
  if (/Waitati/i.test(title))          return 'WAITATI';
  if (/Nook/i.test(title))             return 'NOOK & CRANNY';
  return null;
}

// ‚îÄ‚îÄ Tune-in gate ‚îÄ‚îÄ
function tuneIn() {
  if (hasTunedIn) return;
  hasTunedIn = true;
  document.getElementById('tune-in').classList.add('hide');
  if (playerReady && player) {
    player.unMute();
    player.setVolume(80);
    _muted = false;
    document.getElementById('mute-btn').textContent = 'üîä';
    document.getElementById('vol-icon').textContent = 'üîä';
    document.getElementById('vol-slider').value     = 80;
  }
  // if player isn't ready yet, onPlayerReady will unmute when it fires
}

// ‚îÄ‚îÄ Boot YouTube IFrame API ‚îÄ‚îÄ
(function loadYTAPI() {
  const tag = document.createElement('script');
  tag.src = 'https://www.youtube.com/iframe_api';
  document.head.appendChild(tag);
})();

window.onYouTubeIframeAPIReady = function() {
  player = new YT.Player('yt-player', {
    width: '100%', height: '100%',
    playerVars: {
      autoplay:       1,
      mute:           1,      // browser autoplay requires starting muted
      controls:       0,
      disablekb:      1,
      modestbranding: 1,
      rel:            0,
      iv_load_policy: 3,
      fs:             0,
      playsinline:    1,
    },
    events: {
      onReady:       onPlayerReady,
      onStateChange: onStateChange,
      onError:       onError,
    }
  });
};

function onPlayerReady() {
  playerReady = true;

  // Drop into the broadcast mid-stream
  const { index, seekOffset } = getLivePosition();
  videoIndex     = index;
  liveSeekOffset = seekOffset;
  loadTrack(videoIndex);

  // Only unmute if user has already clicked tune-in
  if (hasTunedIn) {
    player.unMute();
    player.setVolume(80);
    _muted = false;
    document.getElementById('mute-btn').textContent = 'üîä';
    document.getElementById('vol-icon').textContent = 'üîä';
    document.getElementById('vol-slider').value     = 80;
  }
}

// ‚îÄ‚îÄ Load track ‚Äî always via loadVideoById (prevents ads) ‚îÄ‚îÄ
function loadTrack(index) {
  if (!playerReady || !player || !PLAYLIST.length) return;
  const track = PLAYLIST[index];
  if (!track) return;

  clearInterval(progressTimer);
  clipDuration = track.end - track.start;

  const startAt  = track.start + liveSeekOffset;
  liveSeekOffset = 0; // consumed ‚Äî only used on the first load

  player.loadVideoById({
    videoId:      track.id,
    startSeconds: startAt,
    endSeconds:   track.end,
  });

  updateOverlay(track, index, startAt);
}

function onStateChange(e) {
  const S = YT.PlayerState;
  if (e.data === S.PLAYING) {
    isPlaying = true;
    startProgress();
  } else if (e.data === S.PAUSED) {
    isPlaying = false;
    clearInterval(progressTimer);
  } else if (e.data === S.ENDED) {
    clearInterval(progressTimer);
    advance();
  }
}

function onError(e) {
  console.warn('YT error', e.data, '‚Äî skipping');
  advance();
}

function advance() {
  // Brief static flash then channel bump, then next track
  const s = document.getElementById('static');
  s.classList.add('flash');
  setTimeout(() => s.classList.remove('flash'), 80);

  const b = document.getElementById('bump');
  b.classList.add('show');
  setTimeout(() => {
    b.classList.remove('show');
    videoIndex = (videoIndex + 1) % PLAYLIST.length;
    loadTrack(videoIndex);
  }, 650);
}

// ‚îÄ‚îÄ Progress ticker ‚îÄ‚îÄ
function startProgress() {
  clearInterval(progressTimer);
  progressTimer = setInterval(() => {
    if (!player || !playerReady) return;
    const cur     = player.getCurrentTime();
    const track   = PLAYLIST[videoIndex];
    const elapsed = Math.max(0, cur - track.start);
    const pct     = clipDuration > 0 ? Math.min(100, (elapsed / clipDuration) * 100) : 0;
    const pctS    = pct.toFixed(1) + '%';

    document.getElementById('prog-fill').style.width = pctS;
    document.getElementById('clip-bar').style.width  = pctS;
    document.getElementById('prog-cur').textContent  = fmt(elapsed);

    // Broadcast strip: position in today's daily cycle
    const { posInCycle } = getLivePosition();
    document.getElementById('broadcast-fill').style.width =
      (posInCycle / TOTAL_SECONDS * 100).toFixed(3) + '%';
  }, 500);
}

// ‚îÄ‚îÄ Overlay ‚îÄ‚îÄ
function updateOverlay(track, index, startAt) {
  const p     = parseTitle(track.title);
  const event = extractEvent(track.title);

  document.getElementById('lt-artist').textContent  = p.artist;
  document.getElementById('lt-context').textContent = p.context;
  document.getElementById('prog-dur').textContent   = fmt(clipDuration);
  document.getElementById('prog-cur').textContent   = '0:00';
  document.getElementById('prog-fill').style.width  = '0%';
  document.getElementById('clip-bar').style.width   = '0%';

  const badge = document.getElementById('lt-badge');
  if (event) { badge.textContent = event; badge.style.display = 'inline-block'; }
  else        { badge.style.display = 'none'; }

  // Initial broadcast strip position
  const { posInCycle } = getLivePosition();
  document.getElementById('broadcast-fill').style.width =
    (posInCycle / TOTAL_SECONDS * 100).toFixed(3) + '%';
}

// ‚îÄ‚îÄ Volume / Mute ‚îÄ‚îÄ
function toggleMute() {
  if (!player) return;
  _muted = !_muted;
  if (_muted) {
    player.mute();
    document.getElementById('mute-btn').textContent = 'üîá';
    document.getElementById('vol-icon').textContent = 'üîá';
    document.getElementById('vol-slider').value     = 0;
  } else {
    player.unMute();
    const v = Math.max(parseInt(document.getElementById('vol-slider').value) || 80, 10);
    player.setVolume(v);
    document.getElementById('vol-slider').value     = v;
    document.getElementById('mute-btn').textContent = 'üîä';
    document.getElementById('vol-icon').textContent = 'üîä';
    if (!hasTunedIn) { hasTunedIn = true; document.getElementById('tune-in').classList.add('hide'); }
  }
}

function setVolume(v) {
  if (!player) return;
  v = parseInt(v);
  player.setVolume(v);
  if (v > 0 && _muted) {
    player.unMute();
    _muted = false;
    if (!hasTunedIn) { hasTunedIn = true; document.getElementById('tune-in').classList.add('hide'); }
  }
  if (v === 0) { player.mute(); _muted = true; }
  document.getElementById('mute-btn').textContent = v > 0 ? 'üîä' : 'üîá';
  document.getElementById('vol-icon').textContent = v > 0 ? 'üîä' : 'üîá';
}

function toggleFullscreen() {
  if (!document.fullscreenElement) document.documentElement.requestFullscreen();
  else document.exitFullscreen();
}
</script>
</body>
</html>
